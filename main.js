(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_is-animated"),setTimeout((function(){e.classList.add("popup_is-opened")}),1),document.addEventListener("keydown",n)}function o(e){e.classList.add("popup_is-animated"),e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&o(document.querySelector(".popup_is-opened"))}e.d({},{T:()=>B});var r={baseUrl:"https://nomoreparties.co/v1/wff-cohort-17",token:"b1fc3e3d-ea10-4845-afe0-240a5e58f6c9",cohortId:"wff-cohort-17",headers:{authorization:"b1fc3e3d-ea10-4845-afe0-240a5e58f6c9","Content-Type":"application/json"}};function c(){return fetch("".concat(r.baseUrl,"/users/me"),{headers:{authorization:r.token}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}function a(e,o,n,r,c,a){var i=B.cloneNode(!0),p=i.querySelector(".card__image"),s=i.querySelector(".card__title"),l=e.owner._id,d=e._id,_=i.querySelector(".card__delete-button");"33d5db0e38bbc150a00be59e"===l?_.addEventListener("click",(function(){t(c),a.addEventListener("click",(function(){u(d,c,_)}))})):_.hidden=!0;var f=i.querySelector(".card__like-button");f.addEventListener("click",(function(){(function(e,t){return fetch("https://nomoreparties.co/v1/wff-cohort-17/cards/likes/".concat(e),{method:"PUT",headers:{authorization:"b1fc3e3d-ea10-4845-afe0-240a5e58f6c9","Content-Type":"application/json"},body:JSON.stringify({likes:{likes:void 0}})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(d).then((function(e){r(f,e,m,d)}))}));var m=i.querySelector(".current-value-likes"),y=e.likes.length;return m.textContent=y,p.src=e.link,p.alt=e.name,s.textContent=e.name,p.addEventListener("click",(function(){n(e.link,e.name)})),i}function u(e,t,n){var r;(r=e,fetch("https://nomoreparties.co/v1/wff-cohort-17/cards/".concat(r),{method:"DELETE",headers:{authorization:"b1fc3e3d-ea10-4845-afe0-240a5e58f6c9","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){n.closest(".card").remove()})),o(t)}function i(e,t,o,n){if(e.classList.toggle("card__like-button_is-active")){var r=t.likes.length;o.textContent=r}else(function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-17/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"b1fc3e3d-ea10-4845-afe0-240a5e58f6c9","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(n).then((function(e){var t=e.likes.length;o.textContent=t}))}function p(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o)}(e,r,t),function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o.inactiveButtonClass)):(t.disabled=!0,t.classList.add(o.inactiveButtonClass))}(o,n,t)}))}))}(t,e)}))}var s=document.querySelector(".profile__image"),l=document.querySelector(".profile__edit-button"),d=document.querySelector(".profile__add-button"),_=document.querySelectorAll(".popup"),f=document.querySelector(".popup_type_edit"),m=document.querySelector(".popup_type_new-card"),y=document.querySelector(".popup_type_image"),v=document.querySelector(".popup_type_confirm-delete"),h=document.querySelector(".popup_type_avatar"),b=document.querySelector(".popup__image"),S=document.querySelector(".popup__caption"),C=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),k=f.querySelector("div.popup_type_edit .popup__content .popup__form"),g=document.querySelector("div.popup_type_confirm-delete .popup__content-min .popup__form"),E=document.querySelector("div.popup_type_avatar .popup__content .popup__form"),L=E.querySelector(".popup__input_type_url"),j=k.querySelector(".popup__input_type_name"),x=k.querySelector(".popup__input_type_description"),w=m.querySelector("div.popup_type_new-card .popup__content .popup__form"),P=w.querySelector(".popup__input_type_card-name"),T=w.querySelector(".popup__input_type_url"),A=document.querySelector(".places__list"),B=document.querySelector("#card-template").content;function O(e,o){t(y),b.src=e,b.alt=o,S.textContent=o}function z(e,t){t.querySelector(".popup__button").textContent=e?"Сохранение...":"Сохранить"}function D(e,t){t.querySelector(".popup__button").textContent=e?"Сохранение...":"Да"}fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t;t=a(e,0,O,i,v,g),A.append(t)}))})).catch((function(e){console.log(e)})),c().then((function(e){C.textContent=e.name,q.textContent=e.about,s.setAttribute("style","background-image: url('".concat(e.avatar,"')"))})),_.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_is-opened")&&o(e),t.target.classList.contains("popup__close")&&o(e)}))})),s.addEventListener("click",(function(){t(h)})),l.addEventListener("click",(function(){j.value=C.textContent,x.value=q.textContent,t(f),p({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),d.addEventListener("click",(function(){t(m),p({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),k.addEventListener("submit",(function(e){var t,n;e.preventDefault(),z(!0,e.target),(t=j.value,n=x.value,fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:t,about:n})})).then((function(e){c().then((function(e){C.textContent=e.name,q.textContent=e.about}))})).finally((function(){z(!1,e.target)})),o(f)})),w.addEventListener("submit",(function(e){e.preventDefault();var t={name:P.value,link:T.value};z(!0,e.target),function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-17/cards",{method:"POST",headers:{authorization:"b1fc3e3d-ea10-4845-afe0-240a5e58f6c9","Content-Type":"application/json"},body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t).then((function(e){var t;t=a(e,0,O,i,v,g),A.prepend(t)})).finally((function(){z(!1,e.target)})),o(m),e.target.reset()})),E.addEventListener("submit",(function(e){var t;e.preventDefault(),D(!0,e.target),(t=L.value,fetch("https://nomoreparties.co/v1/wff-cohort-17/users/me/avatar",{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){s.setAttribute("style","background-image: url('".concat(e.avatar,"')"))})).finally((function(){D(!1,e.target)})),p({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),o(h)}))})();